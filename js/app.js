"use strict";!function(){angular.module("orodarius",["LocalStorageModule"]).config(["localStorageServiceProvider",function(t){t.setPrefix("orodarius")}]).run(["$window",function(t){$(t).on("resize",_.throttle(function(){$("#main-video-player").attr("width",t.innerWidth).attr("height",t.innerHeight)},400))}])}(),function(){angular.module("orodarius").controller("baseCtrl",["$scope","PlayerService","SidebarService","PlaylistService",function(t,e,i,n){function r(){n.playlist.length&&(e.playPrevious(),t.$apply())}function a(){n.playlist.length&&(e.playNext(),t.$apply())}this.keyboardEventsOptions={38:function(){r()},37:function(){r()},39:function(){a()},40:function(){a()},32:function(){e.playOrPause()},16:function(e){i.toggle(),t.$apply()},27:function(e){i.close(),t.$apply()}}}])}(),function(){angular.module("orodarius").directive("ngBindKeys",["$document",function(t){return{restrict:"A",scope:{ngBindKeysOptions:"=ngBindKeys"},link:function(e,i,n){_(e.ngBindKeysOptions).map(function(t,e){return e}).value();t.on("keydown",function(t){if("INPUT"!==t.target.nodeName){var i=t.which||t.keyCode;e.ngBindKeysOptions[i]&&(t.preventDefault(),e.ngBindKeysOptions[i].call({},t))}})}}}])}(),function(){angular.module("orodarius").directive("ngEnter",function(){return{restrict:"A",replace:!1,scope:{ngEnter:"&",ngEnterOptions:"="},link:function(t,e,i){e.on("keypress",function(i){(13===i.which||13===i.keyCode)&&(t.ngEnter.call(),t.ngEnterOptions.blurOnEnter&&$(e).blur(),t.$apply())})}}})}(),function(){angular.module("orodarius").directive("ngInputChange",function(){return{restrict:"A",scope:{ngInputChange:"&"},replace:!1,link:function(t,e,i){$(e).on("change input",function(){t.ngInputChange.call(null)}),t.$on("$destroy",function(){$(e).off("change input")})}}})}(),function(){angular.module("orodarius").directive("ngScrollOn",["$timeout",function(t){return{restrict:"A",scope:{ngScrollOn:"="},link:function(e,i,n){e.$watch("ngScrollOn",function(e,n){t(function(){var t=$(i).find(".current").parent().prev().prev();t.length&&t[0].scrollIntoView({block:"start",behavior:"smooth"})})})}}}])}(),function(){angular.module("orodarius").directive("youtubePlayer",["$window","PlayerService",function(t,e){return{restrict:"A",replace:!1,link:function(i,n,r){if(!i.isDisabled){var a=$("<script>").attr({src:"https://www.youtube.com/iframe_api",async:!0});$("script").eq(0).before(a)}t.onYouTubeIframeAPIReady=function(){e.createNewPlayer(r.youtubePlayer||"main-video-player")}}}}])}(),function(){angular.module("orodarius").factory("youtubeUrlParser",function(){function t(t){var n=e.exec(t);if(n||(n=i.exec(t)),n){var r=/t=(.*?)&|t=(.*?)$/i,a=0,o=r.exec(t);if(null!==o){var u={h:3600,m:60,s:1},s=/[0-9]+[h|m|s]/gi,l=o[0].match(s);l?l.forEach(function(t){var e=u[t.charAt(t.length-1)],i=parseInt(t.slice(0,-1),10);a+=e*i}):(a=parseInt(o[0].replace("t=",""),10),isNaN(a)&&(a=0))}return{id:n[1],starttime:a}}return""}var e=/^(?:https?:)?(?:\/\/)?(?:www\.|m\.)?youtube\.com\/watch\?.*v=([\w\-]+)/i,i=/^https?:\/\/(?:www\.)?youtu\.be\/([\w\-]+)/i;return t})}(),function(){angular.module("orodarius").filter("thumbnailUrlFilter",function(){return function(t){switch(t){case"nsfw":return"images/nsfw-thumbnail.jpg";case"default":return"images/default-thumbnail.png"}return t}})}(),function(){function t(){return{restrict:"E",scope:!1,templateUrl:"views/player-overlay.html",controllerAs:"vm",controller:function(t){this.PlayerService=t}}}angular.module("orodarius").directive("playerOverlay",t)}(),function(){angular.module("orodarius").service("LastSubredditsService",["localStorageService",function(t){function e(t){i(t)||(u.unshift(t),u=u.slice(0,o),n())}function i(t){return-1!==_.findIndex(u,function(e){return t.name===e.name})}function n(){t.set("lastSubreddits",u)}function r(){return u}var a="lastSubreddits",o=10,u=t.get(a);return angular.isArray(u)||(u=[]),{getList:r,add:e}}])}(),function(){angular.module("orodarius").service("PlayerService",["$window","$timeout","PlaylistService",function(t,e,i){function n(){}function r(t){0===t.data&&this.playNext()}function a(t){-1!=[2,5,100,101,150].indexOf(t.data)&&(this.markCurrentVideoItemWithError(t.data),this.playNext())}function o(t){return t.ownId===this.currentVideoItem.ownId}function u(t){switch(t){case 2:return"can't parse video ID";case 5:return"problem with HTML5 Youtube player";case 100:return"video is private or removed";case 101:case 150:return"uploader does not allow embedded playback"}}this.youtubePlayer=null,this.isPlaying=!1,this.currentVideoItem={},this.markCurrentVideoItemWithError=function(t){var e=this,n=_.findIndex(i.playlist,function(t){return t.ownId===e.currentVideoItem.ownId});i.playlist[n].error={code:t,message:u(t)}},this.createNewPlayer=function(e,i){var o={width:t.innerWidth,height:t.innerHeight,videoId:"DT2oAtQtFrg",playerVars:{autohide:1,autoplay:0,controls:1,disablekb:1,enablejsapi:1}};return angular.extend(o,i),this.youtubePlayer=new YT.Player(e||"main-video-player",o),this.youtubePlayer.addEventListener("onReady",n.bind(this)),this.youtubePlayer.addEventListener("onError",a.bind(this)),this.youtubePlayer.addEventListener("onStateChange",r.bind(this)),this.youtubePlayer},this.playVideo=function(t){if(this.youtubePlayer&&this.youtubePlayer.loadVideoById&&t){if(t.url===!1)return void this.playNext();this.youtubePlayer.loadVideoById({videoId:t.videoId,startSeconds:t.starttime||0,suggestedQuality:"default"}),this.currentVideoItem=t,this.isPlaying=!0}e()},this.playNext=function(){var t=this,e=_.findIndex(i.playlist,o.bind(this))+1;e===i.playlist.length?i.expandPlaylist().then(function(n){t.playVideo(i.playlist[e])}):this.playVideo(i.playlist[e])},this.playPrevious=function(){var t=_.findIndex(i.playlist,o.bind(this))-1;this.playVideo(i.playlist[0>t?0:t],"previous")},this.playOrPause=function(){this.isPlaying?(this.youtubePlayer.pauseVideo(),this.isPlaying=!1):(this.youtubePlayer.playVideo(),this.isPlaying=!0)},this.resetCurrentVideoItem=function(){this.currentVideoItem=void 0}}])}(),function(){angular.module("orodarius").service("PlaylistService",["RedditService",function(t){function e(t){return this.playlist.push(t),o(),this.playlist}function i(){var e=this,i=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return this.isLoading=!0,t.fetch(i).then(function(t){return t?(e.playlist=e.playlist.concat(t),o(),t):void 0},angular.noop)["finally"](function(){return e.isLoading=!1})}function n(){var e=this;return this.isLoading=!0,t.getNext().then(function(t){t&&(e.playlist=e.playlist.concat(t),o())},angular.noop)["finally"](function(){return e.isLoading=!1})}function r(){this.playlist=[],o()}function a(t){u.push(t)}function o(){u.map(function(t){return t()})}var u=[];this.playlist=[],this.isLoading=!1,this.add=e,this.clear=r,this.fetchSubreddit=i,this.expandPlaylist=n,this.subscribePlaylist=a}])}(),function(){angular.module("orodarius").service("RedditService",["$http","$q","youtubeUrlParser","$filter","LastSubredditsService","$log",function(t,e,i,n,r,a){function o(){function i(t,e,i,n){var d=this,g=t.data;f++,p=g.after,y=!1;var m=u(s(g.children));if(m.length&&r.add({name:a}),0===m.length&&h>=f)o.call(this,a,p,v);else{var b=(l(m),_.filter(m,function(t){return c.call(d,t)}));this.items=this.items.concat(b),f=0,v.resolve(b)}}function n(t,e,i,n){y=!1,v.reject(t)}var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],d=arguments.length<=1||void 0===arguments[1]?"":arguments[1],v=e.defer(),b=""+m+a+"/hot.json?limit=50"+(d?"&after="+d:"");return p=d,g=a,y=!0,_.isEmpty(a)?v.reject():t.get(b).success(i.bind(this)).error(n.bind(this)),v.promise}function u(t){var e=_(t).map(function(t){return JSON.stringify(t)}).value();return _(_.uniq(e)).map(function(t){return JSON.parse(t)}).value()}function s(t){return _(t).filter(function(t){return"t3"===t.kind&&"youtube.com"===t.data.domain}).map(function(t){var e=i(t.data.url);return{title:t.data.title,url:t.data.url,videoId:e.id,starttime:e.starttime,thumbnailUrl:n("thumbnailUrlFilter")(t.data.thumbnail),created:t.data.created,redditUrl:"http://reddit.com"+t.data.permalink,redditScore:t.data.score,subreddit:t.data.subreddit,error:null}}).value()}function l(t){var e={"&amp;":"&","&copy;":"©","&reg;":"®"};return _(t).map(function(t){return t.title=t.title.replace(/(&amp;|&copy;|&reg;)/g,function(t){return e[t]}),t.ownId=_.uniqueId("orodarius_video-item_"),t}).value()}function c(t){var e=_(this.items).filter(function(e){return e.videoId===t.videoId}).value().length;return e>0?!1:!0}function d(){var t=e.defer();return y||(p?this.fetch(g,p).then(function(e){return t.resolve(e)},function(){return t.reject()}):(a.warn("cant expand playlist, no afterTag found!"),t.reject())),t.promise}var f=0,h=3,p="",y=!1,g="";this.fetch=o,this.items=[],this.getNext=d;var m="http://www.reddit.com/r/"}])}(),function(){var t={isSidebarSticky:!1,isFocusForced:!1,sources:[{name:"reddit",apiUrl:"http://www.reddit.com/r/",isEnabled:!0}]};angular.module("orodarius").service("SettingsService",["localStorageService",function(e){function i(t,e){o[t]=e,r()}function n(t){"undefined"!=typeof o[t]?(o[t]=!o[t],r()):o[t]=!0}function r(){e.set(a,o)}var a="settings",o=e.get(a);return null===o&&(o=t,r()),_.isUndefined(o.sources)&&(o.sources=t.sources,r()),{list:o,add:i,toggle:n}}])}(),function(){angular.module("orodarius").service("SidebarService",function(){this.isOpen=!0,this.toggle=function(t){this.isOpen=t||!this.isOpen},this.close=function(){this.isOpen=!1}})}(),function(){angular.module("orodarius").controller("sidebarCtrl",["$scope","$http","$timeout","$window","PlaylistService","PlayerService","SidebarService","LastSubredditsService","SettingsService",function(t,e,i,n,r,a,o,u,s){function l(){i(function(){return n.focus()},100)}var c=this;t.sidebarService=o,t.playerService=a,this.lastSubreddits=u.getList(),this.currentSubreddit="",this.isLoading=!1,this.settings=s.list,this.lastUpdatedData={},this.playlist=r.playlist,r.subscribePlaylist(function(){c.playlist=r.playlist}),this.toggleSidebar=function(){o.toggle()},this.toggleFocusForced=function(){s.toggle("isFocusForced"),n[(s.list.isFocusForced?"add":"remove")+"EventListener"]("blur",l)},this.toggleStickySidebar=function(){s.toggle("isSidebarSticky")},this.playVideo=function(t){a.playVideo(t),s.list.isSidebarSticky||o.toggle()},this.fillPlaylistWith=function(t){var e=this;r.clear(),t&&(this.currentSubreddit=t,this.isLoading=!0,r.fetchSubreddit(t).then(function(t){e.isLoading=!1,e.playlist=t,a.playVideo(r.playlist[0])}))},this.expandPlaylist=function(){var t=this;this.isLoading=!0,r.expandPlaylist()["finally"](function(){return t.isLoading=!1})},this.suggestedSubreddits=[{name:"videos"},{name:"youtubehaiku"},{name:"artisanvideos"},{name:"listentothis"},{name:"gamephysics"},{name:"music"},{name:"videos+youtubehaiku"}],this.isListItemCurrentlyPlayed=function(t){return t.videoId===a.currentVideoItem.videoId},s.list.isFocusForced&&n.addEventListener("blur",l),this.getLastUpdated=function(){var t=this;e.get("https://api.github.com/repos/argshook/orodarius/commits/gh-pages").then(function(e){return t.lastUpdatedData={url:e.data.html_url,date:e.data.commit.author.date,message:e.data.commit.message}})},this.getLastUpdated()}])}(),function(){angular.module("orodarius").directive("orodariusSidebar",function(){return{restrict:"E",replace:!0,templateUrl:"views/orodarius-sidebar.html",controller:"sidebarCtrl",controllerAs:"sidebarCtrl",bindToController:!0}})}(),function(){angular.module("orodarius").directive("videoItem",function(){return{restrict:"E",scope:!0,templateUrl:"views/video-item.html"}})}();