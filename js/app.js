"use strict";!function(){angular.module("orodarius",["LocalStorageModule","ngAnimate"]),angular.module("orodarius").config(["localStorageServiceProvider",function(t){t.setPrefix("orodarius")}]),angular.module("orodarius").run(["$window",function(t){$(t).on("resize",_.throttle(function(){$("#main-video-player").attr("width",t.innerWidth).attr("height",t.innerHeight)},400))}])}(),function(){angular.module("orodarius").directive("ngBindKeys",["$document",function(t){return{restrict:"A",scope:{ngBindKeysOptions:"=ngBindKeys"},link:function(e,n,i){_(e.ngBindKeysOptions).map(function(t,e){return e}).value();t.on("keydown",function(t){if("INPUT"!==t.target.nodeName){var n=t.which||t.keyCode;e.ngBindKeysOptions[n]&&(t.preventDefault(),e.ngBindKeysOptions[n].call({},t))}})}}}])}(),function(){angular.module("orodarius").directive("ngEnter",function(){return{restrict:"A",replace:!1,scope:{ngEnter:"&",ngEnterOptions:"="},link:function(t,e,n){e.on("keypress",function(n){(13===n.which||13===n.keyCode)&&(t.ngEnter.call(),t.ngEnterOptions.blurOnEnter&&$(e).blur(),t.$apply())})}}})}(),function(){angular.module("orodarius").directive("ngInputChange",function(){return{restrict:"A",scope:{ngInputChange:"&"},replace:!1,link:function(t,e,n){$(e).on("change input",function(){t.ngInputChange.call(null)}),t.$on("$destroy",function(){$(e).off("change input")})}}})}(),function(){angular.module("orodarius").directive("ngScrollTo",["$rootScope","$timeout",function(t,e){return{restrict:"A",scope:{ngScrollTo:"=",offsetTop:"@"},link:function(n,i){var r=$(i);t.$on("orodariusScrollIntoView",function(){e(function(){var t=$(i).find(n.ngScrollTo);t.length&&(r.get(0).scrollTop=0,r.get(0).scrollTop=t.position().top-(parseInt(r.css("padding-top"),10)||0)-parseInt(n.offsetTop,10))},100)})}}}])}(),function(){angular.module("orodarius").directive("youtubePlayer",["$window","PlayerService",function(t,e){return{restrict:"A",replace:!1,link:function(n,i,r){if(!n.isDisabled){var o=$("<script>").attr({src:"https://www.youtube.com/iframe_api",async:!0});$("script").eq(0).before(o)}t.onYouTubeIframeAPIReady=function(){e.createNewPlayer(r.youtubePlayer||"main-video-player")}}}}])}(),function(){function t(t){var n=r.reduce(function(e,n){var i=n.exec(t);return i?i:e},null);return n?{id:n[1],starttime:e(t)}:null}function e(t){var e=/t=(.*?)&|t=(.*?)$/i,n=e.exec(decodeURIComponent(t)),i=0;return null!==n&&!function(){var t={h:3600,m:60,s:1},e=/[0-9]+[h|m|s]/gi,r=n[0].match(e);r?r.forEach(function(e){var n=t[e.charAt(e.length-1)],r=parseInt(e.slice(0,-1),10);i+=n*r}):i=parseInt(n[0].replace("t=",""),10)||0}(),i}angular.module("orodarius").factory("youtubeUrlParser",function(){return t});var n="^(?:https?:)?(?://)?(?:www\\.|m\\.)?",i="([\\w\\-]+)",r=["youtube\\.com\\/watch\\?.*v="+i,"youtube\\.com/v/"+i,"youtu\\.be\\/"+i,"youtube\\.com\\/attribution_link\\?.+(?:watch%3Fv%3D)"+i,"youtube\\.com\\/shared\\?ci="+i].map(function(t){return n+t}).map(function(t){return new RegExp(t,"i")})}(),function(){function t(t){return[t].map(function(t){return"string"==typeof t?t:""}).map(function(t){return t.replace(/^http:\/\//,"https://")}).map(function(t){switch(t){case"nsfw":return"images/nsfw-thumbnail.jpg";case"default":return"images/default-thumbnail.png";default:return t}}).shift()}angular.module("orodarius").filter("thumbnailUrlFilter",function(){return function(e){return t(e)}})}(),function(){function t(){return{bindings:{},templateUrl:"views/player-overlay.html",controller:["PlayerService",function(t){this.getCurrentVideoItem=function(){return t.currentVideoItem}}]}}angular.module("orodarius").component("playerOverlay",t())}(),function(){angular.module("orodarius").component("player",{bindings:{},templateUrl:"views/player.html",controller:function(){}})}(),function(){angular.module("orodarius").component("root",{bindings:{},templateUrl:"views/root.html",controller:["$scope","PlayerService","PlaylistService","SidebarService",function(t,e,n,i){function r(){n.playlist.length&&(e.playPrevious(),t.$apply())}function o(){n.playlist.length&&(e.playNext(),t.$apply())}this.keyboardEventsOptions={38:function(){r()},37:function(){r()},39:function(){o()},40:function(){o()},32:function(){e.playOrPause()},16:function(e){i.toggle(),t.$apply()},27:function(e){"settings"===i.state.get()?i.state.set("main"):i.close(),t.$apply()},83:function(e){"settings"!==i.state.get()&&(i.state.set("settings"),t.$apply())}}}]})}(),function(){angular.module("orodarius").service("LastSubredditsService",["localStorageService",function(t){function e(t){n(t)||(u.unshift(t),u=u.slice(0,a),i())}function n(t){return-1!==_.findIndex(u,function(e){return t.name===e.name})}function i(){t.set("lastSubreddits",u)}function r(){return u}var o="lastSubreddits",a=10,u=t.get(o);return angular.isArray(u)||(u=[]),{getList:r,add:e}}])}();var _slicedToArray=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(i=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(s){r=!0,o=s}finally{try{!i&&u["return"]&&u["return"]()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();!function(){angular.module("orodarius").service("PlayerService",["$window","$timeout","PlaylistService","SettingsService","$rootScope",function(t,e,n,i,r){function o(){}function a(t){-1!=[2,5,100,101,150].indexOf(t.data)&&(this.markCurrentVideoItemWithError(t.data),this.playNext())}function u(t){return t.ownId===this.currentVideoItem.ownId}function s(t){switch(t){case 2:return"can't parse video ID";case 5:return"problem with HTML5 Youtube player";case 100:return"video is private or removed";case 101:case 150:return"uploader does not allow embedded playback"}}this.youtubePlayer=null,this.isPlaying=!1,this.currentVideoItem={},this.markCurrentVideoItemWithError=function(t){var e=_.findIndex(n.playlist,u.bind(this));n.playlist[e].error={code:t,message:s(t)}},this.cleanCurrentVideoItemErrors=function(){var t=_.findIndex(n.playlist,u.bind(this));n.playlist[t].error=null},this.createNewPlayer=function(e,n){var i={width:t.innerWidth,height:t.innerHeight,videoId:"ZGXh-kgedkI",playerVars:{autohide:1,autoplay:0,controls:1,disablekb:1,enablejsapi:1}};return angular.extend(i,n),this.youtubePlayer=new YT.Player(e||"main-video-player",i),this.youtubePlayer.addEventListener("onReady",o.bind(this)),this.youtubePlayer.addEventListener("onError",a.bind(this)),this.youtubePlayer.addEventListener("onStateChange",this.onPlayerStateChange.bind(this)),this.youtubePlayer},this.playVideo=function(t){if(this.youtubePlayer&&this.youtubePlayer.loadVideoById&&t){if(t.url===!1)return void this.playNext();this.youtubePlayer.loadVideoById({videoId:t.videoId,startSeconds:t.starttime||0,suggestedQuality:"default"}),this.currentVideoItem=t,this.isPlaying=!0,i.set("watchCount",i.list.watchCount+1)}},this.playNext=function(){var t=this,e=_.findIndex(n.playlist,u.bind(this))+1;e>=Math.max(n.playlist.length-3,0)?n.expandPlaylist().then(function(i){t.playVideo(n.playlist[e]),r.$emit("orodariusScrollIntoView")}):(this.playVideo(n.playlist[e]),r.$emit("orodariusScrollIntoView"))},this.playPrevious=function(){var t=_.findIndex(n.playlist,u.bind(this))-1;this.playVideo(n.playlist[0>t?0:t],"previous"),r.$emit("orodariusScrollIntoView")},this.playOrPause=function(){this.isPlaying?(this.youtubePlayer.pauseVideo(),this.isPlaying=!1):(this.youtubePlayer.playVideo(),this.isPlaying=!0)},this.resetCurrentVideoItem=function(){this.currentVideoItem=void 0},this.onPlayerStateChange=function(t){var n=this,r=[[i.list.isFocusForced,function(){return document.activeElement.blur()}],[i.list.isFlashModeEnabled&&1===t.data,function(){return e(function(){n.playNext()},5e3)}],[0===t.data,function(){return n.playNext()}],[1===t.data,function(){return n.cleanCurrentVideoItemErrors()}]];r.map(function(t){var e=_slicedToArray(t,2),n=e[0],i=e[1];return n?i():null})}}])}(),function(){angular.module("orodarius").service("PlaylistService",["RedditService",function(t){function e(t){return this.playlist.push(t),a(),this.playlist}function n(){var e=this,n=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return this.isLoading=!0,t.fetch(n).then(function(t){return t?(e.playlist=e.playlist.concat(t),a(),t):void 0},angular.noop)["finally"](function(){return e.isLoading=!1})}function i(){var e=this;return this.isLoading=!0,t.getNext().then(function(t){t&&(e.playlist=e.playlist.concat(t),a())},angular.noop)["finally"](function(){return e.isLoading=!1})}function r(){this.playlist=[],t.clear(),a()}function o(t){u.push(t)}function a(){u.map(function(t){return t()})}var u=[];this.playlist=[],this.isLoading=!1,this.add=e,this.clear=r,this.fetchSubreddit=n,this.expandPlaylist=i,this.subscribePlaylist=o}])}(),function(){function t(t,i,r,o,a,u){function s(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],r=arguments.length<=1||void 0===arguments[1]?"":arguments[1],o=""+n+e+"/hot.json?limit=50"+(r?"&after="+r:"");return y=r,b=e,v=!0,_.isEmpty(e)?i.reject():t.get(o).then(l.bind(this))["catch"](function(){return i.reject()})["finally"](function(){return v=!1})}function l(t){var n=this,r=t.data.data;m++,y=r.after;var o=c(d(r.children));if(0===o.length&&e>=m)return s.call(this,b,y);var u=f(o).filter(function(t){return!h(n.items,t)});return this.items=this.items.concat(u),m=0,a.add({name:b}),i.resolve(u)}function c(t){var e=_(t).map(function(t){return JSON.stringify(t)}).value();return _(_.uniq(e)).map(function(t){return JSON.parse(t)}).value()}function d(t){return t.filter(function(t){var e=t.kind;return"t3"===e}).filter(function(t){var e=t.data;return/^(m\.)?youtu\.?be/.test(e.domain)}).map(function(t){var e=r(t.data.url);return{title:t.data.title,url:t.data.url,videoId:e.id,starttime:e.starttime,thumbnailUrl:o("thumbnailUrlFilter")(t.data.thumbnail),created:t.data.created,redditUrl:"https://reddit.com"+t.data.permalink,redditScore:t.data.score,subreddit:t.data.subreddit,error:null}})}function f(t){var e={"&amp;":"&","&copy;":"©","&reg;":"®"};return t.map(function(t){return t.title=t.title.replace(/(&amp;|&copy;|&reg;)/g,function(t){return e[t]}),t.ownId=_.uniqueId("orodarius_video-item_"),t})}function h(t,e){return t.some(function(t){return t.videoId===e.videoId})}function p(){return v?i.reject():y?this.fetch(b,y):(u.warn("cant expand playlist, no afterTag found!"),i.reject())}function g(){this.items=[]}var m=0,y="",v=!1,b="";return{fetch:s,getNext:p,clear:g,items:[]}}angular.module("orodarius").service("RedditService",["$http","$q","youtubeUrlParser","$filter","LastSubredditsService","$log",t]);var e=3,n="https://www.reddit.com/r/"}(),function(){var t={watchCount:0,isSidebarSticky:!1,isFocusForced:!1,sources:[{name:"reddit",apiUrl:"https://www.reddit.com/r/",isEnabled:!0}]};angular.module("orodarius").service("SettingsService",["localStorageService",function(e){function n(t,e){u[t]=e,o()}function i(t){"undefined"!=typeof u[t]?(u[t]=!u[t],o()):u[t]=!0}function r(t,e){u[t]=e,o()}function o(){e.set(a,u)}var a="settings",u=e.get(a);return null===u&&(u=t,o()),_.defaultsDeep(u,t),o(),{list:u,add:n,toggle:i,set:r}}])}(),function(){angular.module("orodarius").service("SidebarService",function(){this.state=new function(){var t="main",e=[],n=function(e){return t=e},i=function(){return t},r=function(){return _.each(e,function(e){return e(t)})},o=function(t){return e=[t].concat(e),t},a=function(t){return e=_.without(e,t)},u=function(t){return function(){return a(t)}};return{get:i,set:_.flow(n,r),subscribe:_.flow(o,u)}},this.isOpen=!0,this.toggle=function(t){this.isOpen=t||!this.isOpen},this.close=function(){this.isOpen=!1}})}(),function(){angular.module("orodarius").component("settingsPanel",{bindings:{},templateUrl:"views/sidebar/settings-panel.html",controller:["SettingsService","$window","$timeout",function(t,e,n){function i(){t.toggle("isSidebarSticky")}function r(){t.toggle("isFlashModeEnabled")}function o(){t.toggle("isFocusForced"),e[(t.list.isFocusForced?"add":"remove")+"EventListener"]("blur",a)}function a(){n(function(){return e.focus()},100)}this.settings=t.list,this.toggleStickySidebar=i,this.toggleFlashMode=r,this.toggleFocusForced=o,t.list.isFocusForced&&e.addEventListener("blur",a)}]})}(),function(){angular.module("orodarius").component("sidebarEmpty",{bindings:{onSubredditClick:"&"},templateUrl:"views/sidebar/sidebar-empty.html",controller:["LastSubredditsService",function(t){this.lastSubreddits=t.getList(),this.suggestedSubreddits=[{name:"videos"},{name:"youtubehaiku"},{name:"artisanvideos"},{name:"listentothis"},{name:"gamephysics"},{name:"music"},{name:"videos+youtubehaiku"}]}]})}(),function(){angular.module("orodarius").component("sidebarFoot",{bindings:{},templateUrl:"views/sidebar/sidebar-foot.html",controller:["$http",function(t){this.lastUpdatedData={},this.getLastUpdated=function(){var e=this;t.get("https://api.github.com/repos/argshook/orodarius/commits/gh-pages").then(function(t){return e.lastUpdatedData={url:t.data.html_url,date:t.data.commit.author.date,message:t.data.commit.message}})},this.getLastUpdated()}]})}(),function(){angular.module("orodarius").component("sidebarHead",{bindings:{isLoading:"=",currentSubreddit:"=",currentState:"=",onSearchStart:"&",onSettingsClick:"&"},templateUrl:"views/sidebar/sidebar-head.html"})}(),function(){angular.module("orodarius").component("sidebarList",{bindings:{list:"=",currentSubreddit:"=",isLoading:"=",onItemClick:"&",onExpandClick:"&"},templateUrl:"views/sidebar/sidebar-list.html"})}(),function(){angular.module("orodarius").component("sidebar",{bindings:{},templateUrl:"views/sidebar/sidebar.html",controller:["PlaylistService","PlayerService","SidebarService","SettingsService","$rootScope",function(t,e,n,i,r){function o(t){e.playVideo(t),i.list.isSidebarSticky||n.toggle()}function a(){var e=this;this.isLoading=!0,t.expandPlaylist().then(function(){return e.isLoading=!1})}function u(n){var i=this;t.clear(),n&&!this.isLoading&&(this.currentSubreddit=n,this.isLoading=!0,t.fetchSubreddit(n).then(function(n){i.isLoading=!1,i.playlist=n,e.playVideo(t.playlist[0])})),n||(this.isLoading=!1)}function s(){return n.isOpen}function l(){n.toggle()}function c(t){var e=n.state.get();n.state.set("main"===e?"settings":"main")}var d=this;this.currentSubreddit="",this.isLoading=!1,this.playlist=t.playlist,this.currentState=n.state.get(),this.getIsOpen=s,this.toggle=l,this.playVideo=o,this.expandPlaylist=a,this.fillPlaylistWith=u,this.toggleSettingsState=c,t.subscribePlaylist(function(){d.playlist=t.playlist}),n.state.subscribe(function(t){d.currentState=t,"main"===t&&r.$broadcast("orodariusScrollIntoView")})}]})}(),function(){angular.module("orodarius").component("videoItem",{bindings:{item:"=videoItem",currentSubreddit:"=currentSubreddit",index:"="},templateUrl:"views/video-item.html",controller:["PlayerService",function(t){function e(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return e===t.currentVideoItem.ownId}this.playerService=t,this.getIsIdCurrent=e}]})}();