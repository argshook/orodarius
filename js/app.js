"use strict";!function(){angular.module("orodarius",["LocalStorageModule","ngAnimate"]),angular.module("orodarius").config(["localStorageServiceProvider",function(t){t.setPrefix("orodarius")}]),angular.module("orodarius").run(["$window",function(t){$(t).on("resize",_.throttle(function(){$("#main-video-player").attr("width",t.innerWidth).attr("height",t.innerHeight)},400))}])}(),function(){angular.module("orodarius").directive("ngBindKeys",["$document",function(t){return{restrict:"A",scope:{ngBindKeysOptions:"=ngBindKeys"},link:function(e,i,n){_(e.ngBindKeysOptions).map(function(t,e){return e}).value();t.on("keydown",function(t){if("INPUT"!==t.target.nodeName){var i=t.which||t.keyCode;e.ngBindKeysOptions[i]&&(t.preventDefault(),e.ngBindKeysOptions[i].call({},t))}})}}}])}(),function(){angular.module("orodarius").directive("ngEnter",function(){return{restrict:"A",replace:!1,scope:{ngEnter:"&",ngEnterOptions:"="},link:function(t,e,i){e.on("keypress",function(i){(13===i.which||13===i.keyCode)&&(t.ngEnter.call(),t.ngEnterOptions.blurOnEnter&&$(e).blur(),t.$apply())})}}})}(),function(){angular.module("orodarius").directive("ngInputChange",function(){return{restrict:"A",scope:{ngInputChange:"&"},replace:!1,link:function(t,e,i){$(e).on("change input",function(){t.ngInputChange.call(null)}),t.$on("$destroy",function(){$(e).off("change input")})}}})}(),function(){angular.module("orodarius").directive("ngScrollOn",["$timeout",function(t){return{restrict:"A",scope:{ngScrollOn:"="},link:function(e,i,n){e.$watch("ngScrollOn",function(e,n){t(function(){var t=$(i).find(".current").parent().prev().prev();t.length&&t[0].scrollIntoView({block:"start",behavior:"smooth"})})})}}}])}(),function(){angular.module("orodarius").directive("youtubePlayer",["$window","PlayerService",function(t,e){return{restrict:"A",replace:!1,link:function(i,n,r){if(!i.isDisabled){var a=$("<script>").attr({src:"https://www.youtube.com/iframe_api",async:!0});$("script").eq(0).before(a)}t.onYouTubeIframeAPIReady=function(){e.createNewPlayer(r.youtubePlayer||"main-video-player")}}}}])}(),function(){angular.module("orodarius").factory("youtubeUrlParser",function(){function t(t){var n=e.exec(t);if(n||(n=i.exec(t)),n){var r=/t=(.*?)&|t=(.*?)$/i,a=0,o=r.exec(t);if(null!==o){var s={h:3600,m:60,s:1},u=/[0-9]+[h|m|s]/gi,l=o[0].match(u);l?l.forEach(function(t){var e=s[t.charAt(t.length-1)],i=parseInt(t.slice(0,-1),10);a+=e*i}):(a=parseInt(o[0].replace("t=",""),10),isNaN(a)&&(a=0))}return{id:n[1],starttime:a}}return""}var e=/^(?:https?:)?(?:\/\/)?(?:www\.|m\.)?youtube\.com\/watch\?.*v=([\w\-]+)/i,i=/^https?:\/\/(?:www\.)?youtu\.be\/([\w\-]+)/i;return t})}(),function(){angular.module("orodarius").filter("thumbnailUrlFilter",function(){return function(t){switch(t){case"nsfw":return"images/nsfw-thumbnail.jpg";case"default":return"images/default-thumbnail.png"}return t}})}(),function(){function t(){return{bindings:{},templateUrl:"views/player-overlay.html",controller:["PlayerService",function(t){this.getCurrentVideoItem=function(){return t.currentVideoItem}}]}}angular.module("orodarius").component("playerOverlay",t())}(),function(){angular.module("orodarius").component("player",{bindings:{},templateUrl:"views/player.html",controller:function(){}})}(),function(){angular.module("orodarius").component("root",{bindings:{},templateUrl:"views/root.html",controller:["$scope","PlayerService","PlaylistService","SidebarService",function(t,e,i,n){function r(){i.playlist.length&&(e.playPrevious(),t.$apply())}function a(){i.playlist.length&&(e.playNext(),t.$apply())}this.keyboardEventsOptions={38:function(){r()},37:function(){r()},39:function(){a()},40:function(){a()},32:function(){e.playOrPause()},16:function(e){n.toggle(),t.$apply()},27:function(e){n.close(),t.$apply()}}}]})}(),function(){angular.module("orodarius").service("LastSubredditsService",["localStorageService",function(t){function e(t){i(t)||(s.unshift(t),s=s.slice(0,o),n())}function i(t){return-1!==_.findIndex(s,function(e){return t.name===e.name})}function n(){t.set("lastSubreddits",s)}function r(){return s}var a="lastSubreddits",o=10,s=t.get(a);return angular.isArray(s)||(s=[]),{getList:r,add:e}}])}(),function(){angular.module("orodarius").service("PlayerService",["$window","$timeout","PlaylistService","SettingsService",function(t,e,i,n){function r(){}function a(t){-1!=[2,5,100,101,150].indexOf(t.data)&&(this.markCurrentVideoItemWithError(t.data),this.playNext())}function o(t){return t.ownId===this.currentVideoItem.ownId}function s(t){switch(t){case 2:return"can't parse video ID";case 5:return"problem with HTML5 Youtube player";case 100:return"video is private or removed";case 101:case 150:return"uploader does not allow embedded playback"}}this.youtubePlayer=null,this.isPlaying=!1,this.currentVideoItem={},this.markCurrentVideoItemWithError=function(t){var e=this,n=_.findIndex(i.playlist,function(t){return t.ownId===e.currentVideoItem.ownId});i.playlist[n].error={code:t,message:s(t)}},this.createNewPlayer=function(e,i){var n={width:t.innerWidth,height:t.innerHeight,videoId:"DT2oAtQtFrg",playerVars:{autohide:1,autoplay:0,controls:1,disablekb:1,enablejsapi:1}};return angular.extend(n,i),this.youtubePlayer=new YT.Player(e||"main-video-player",n),this.youtubePlayer.addEventListener("onReady",r.bind(this)),this.youtubePlayer.addEventListener("onError",a.bind(this)),this.youtubePlayer.addEventListener("onStateChange",this.onPlayerStateChange.bind(this)),this.youtubePlayer},this.playVideo=function(t){if(this.youtubePlayer&&this.youtubePlayer.loadVideoById&&t){if(t.url===!1)return void this.playNext();this.youtubePlayer.loadVideoById({videoId:t.videoId,startSeconds:t.starttime||0,suggestedQuality:"default"}),this.currentVideoItem=t,this.isPlaying=!0,n.set("watchCount",n.list.watchCount+1)}e()},this.playNext=function(){var t=this,e=_.findIndex(i.playlist,o.bind(this))+1;e===i.playlist.length?i.expandPlaylist().then(function(n){t.playVideo(i.playlist[e])}):this.playVideo(i.playlist[e])},this.playPrevious=function(){var t=_.findIndex(i.playlist,o.bind(this))-1;this.playVideo(i.playlist[0>t?0:t],"previous")},this.playOrPause=function(){this.isPlaying?(this.youtubePlayer.pauseVideo(),this.isPlaying=!1):(this.youtubePlayer.playVideo(),this.isPlaying=!0)},this.resetCurrentVideoItem=function(){this.currentVideoItem=void 0},this.onPlayerStateChange=function(t){var i=this;n.list.isFlashModeEnabled&&1===t.data&&e(function(){i.playNext()},5e3),0===t.data&&this.playNext()}}])}(),function(){angular.module("orodarius").service("PlaylistService",["RedditService",function(t){function e(t){return this.playlist.push(t),o(),this.playlist}function i(){var e=this,i=arguments.length<=0||void 0===arguments[0]?"":arguments[0];return this.isLoading=!0,t.fetch(i).then(function(t){return t?(e.playlist=e.playlist.concat(t),o(),t):void 0},angular.noop)["finally"](function(){return e.isLoading=!1})}function n(){var e=this;return this.isLoading=!0,t.getNext().then(function(t){t&&(e.playlist=e.playlist.concat(t),o())},angular.noop)["finally"](function(){return e.isLoading=!1})}function r(){this.playlist=[],o()}function a(t){s.push(t)}function o(){s.map(function(t){return t()})}var s=[];this.playlist=[],this.isLoading=!1,this.add=e,this.clear=r,this.fetchSubreddit=i,this.expandPlaylist=n,this.subscribePlaylist=a}])}(),function(){angular.module("orodarius").service("RedditService",["$http","$q","youtubeUrlParser","$filter","LastSubredditsService","$log",function(t,e,i,n,r,a){function o(){function i(t,e,i,n){var d=this,m=t.data;h++,g=m.after,p=!1;var y=s(u(m.children));if(y.length&&r.add({name:a}),0===y.length&&f>=h)o.call(this,a,g,v);else{var b=(l(y),_.filter(y,function(t){return c.call(d,t)}));this.items=this.items.concat(b),h=0,v.resolve(b)}}function n(t,e,i,n){p=!1,v.reject(t)}var a=arguments.length<=0||void 0===arguments[0]?"":arguments[0],d=arguments.length<=1||void 0===arguments[1]?"":arguments[1],v=e.defer(),b=""+y+a+"/hot.json?limit=50"+(d?"&after="+d:"");return g=d,m=a,p=!0,_.isEmpty(a)?v.reject():t.get(b).success(i.bind(this)).error(n.bind(this)),v.promise}function s(t){var e=_(t).map(function(t){return JSON.stringify(t)}).value();return _(_.uniq(e)).map(function(t){return JSON.parse(t)}).value()}function u(t){return _(t).filter(function(t){return"t3"===t.kind&&"youtube.com"===t.data.domain}).map(function(t){var e=i(t.data.url);return{title:t.data.title,url:t.data.url,videoId:e.id,starttime:e.starttime,thumbnailUrl:n("thumbnailUrlFilter")(t.data.thumbnail),created:t.data.created,redditUrl:"http://reddit.com"+t.data.permalink,redditScore:t.data.score,subreddit:t.data.subreddit,error:null}}).value()}function l(t){var e={"&amp;":"&","&copy;":"©","&reg;":"®"};return _(t).map(function(t){return t.title=t.title.replace(/(&amp;|&copy;|&reg;)/g,function(t){return e[t]}),t.ownId=_.uniqueId("orodarius_video-item_"),t}).value()}function c(t){var e=_(this.items).filter(function(e){return e.videoId===t.videoId}).value().length;return e>0?!1:!0}function d(){var t=e.defer();return p||(g?this.fetch(m,g).then(function(e){return t.resolve(e)},function(){return t.reject()}):(a.warn("cant expand playlist, no afterTag found!"),t.reject())),t.promise}var h=0,f=3,g="",p=!1,m="";this.fetch=o,this.items=[],this.getNext=d;var y="http://www.reddit.com/r/"}])}(),function(){var t={watchCount:0,isSidebarSticky:!1,isFocusForced:!1,sources:[{name:"reddit",apiUrl:"http://www.reddit.com/r/",isEnabled:!0}]};angular.module("orodarius").service("SettingsService",["localStorageService",function(e){function i(t,e){s[t]=e,a()}function n(t){"undefined"!=typeof s[t]?(s[t]=!s[t],a()):s[t]=!0}function r(t,e){s[t]=e,a()}function a(){e.set(o,s)}var o="settings",s=e.get(o);return null===s&&(s=t,a()),_.defaultsDeep(s,t),a(),{list:s,add:i,toggle:n,set:r}}])}(),function(){angular.module("orodarius").service("SidebarService",function(){this.isOpen=!0,this.toggle=function(t){this.isOpen=t||!this.isOpen},this.close=function(){this.isOpen=!1}})}(),function(){angular.module("orodarius").component("settingsPanel",{bindings:{},templateUrl:"views/sidebar/settings-panel.html",controller:["SettingsService","$window","$timeout",function(t,e,i){function n(){t.toggle("isSidebarSticky")}function r(){t.toggle("isFlashModeEnabled")}function a(){t.toggle("isFocusForced"),e[(t.list.isFocusForced?"add":"remove")+"EventListener"]("blur",o)}function o(){i(function(){return e.focus()},100)}this.settings=t.list,this.toggleStickySidebar=n,this.toggleFlashMode=r,this.toggleFocusForced=a,t.list.isFocusForced&&e.addEventListener("blur",o)}]})}(),function(){angular.module("orodarius").component("sidebarEmpty",{bindings:{onSubredditClick:"&"},templateUrl:"views/sidebar/sidebar-empty.html",controller:["LastSubredditsService",function(t){this.lastSubreddits=t.getList(),this.suggestedSubreddits=[{name:"videos"},{name:"youtubehaiku"},{name:"artisanvideos"},{name:"listentothis"},{name:"gamephysics"},{name:"music"},{name:"videos+youtubehaiku"}]}]})}(),function(){angular.module("orodarius").component("sidebarFoot",{bindings:{},templateUrl:"views/sidebar/sidebar-foot.html",controller:["$http",function(t){this.lastUpdatedData={},this.getLastUpdated=function(){var e=this;t.get("https://api.github.com/repos/argshook/orodarius/commits/gh-pages").then(function(t){return e.lastUpdatedData={url:t.data.html_url,date:t.data.commit.author.date,message:t.data.commit.message}})},this.getLastUpdated()}]})}(),function(){angular.module("orodarius").component("sidebarHead",{bindings:{isLoading:"=",currentSubreddit:"=",onSearchStart:"&",onStateSet:"&"},templateUrl:"views/sidebar/sidebar-head.html",controller:["SettingsService","SidebarService","$window","$timeout",function(t,e,i,n){function r(){var t=this,e="main";return function(){e="main"===e?"settings":"main",t.isSettingsPanelVisible=!t.isSettingsPanelVisible,t.onStateSet({state:e})}}this.isSettingsPanelVisible=!1,this.sidebarService=e,this.settings=t.list,this.toggleIsSettingsPanelVisible=r.call(this),this.toggleSidebar=function(){e.toggle()}}]})}(),function(){angular.module("orodarius").component("sidebarList",{bindings:{list:"=",currentSubreddit:"=",isLoading:"=",onItemClick:"&",onExpandClick:"&"},templateUrl:"views/sidebar/sidebar-list.html",controller:["PlayerService",function(t){this.getCurrentVideoItem=function(){return t.currentVideoItem}}]})}(),function(){angular.module("orodarius").component("sidebar",{bindings:{},templateUrl:"views/sidebar/sidebar.html",controller:["PlaylistService","PlayerService","SidebarService","SettingsService",function(t,e,i,n){function r(t){e.playVideo(t),n.list.isSidebarSticky||i.toggle()}function a(){var e=this;this.isLoading=!0,t.expandPlaylist().then(function(){return e.isLoading=!1})}function o(i){var n=this;t.clear(),i&&(this.currentSubreddit=i,this.isLoading=!0,t.fetchSubreddit(i).then(function(i){n.isLoading=!1,n.playlist=i,e.playVideo(t.playlist[0])}))}function s(){return i.isOpen}function u(){i.toggle()}function l(t){this.currentState=t}var c=this;this.currentSubreddit="",this.isLoading=!1,this.playlist=t.playlist,this.currentState="main",this.getIsOpen=s,this.toggle=u,this.playVideo=r,this.expandPlaylist=a,this.fillPlaylistWith=o,this.setCurrentState=l,t.subscribePlaylist(function(){c.playlist=t.playlist})}]})}(),function(){angular.module("orodarius").component("videoItem",{bindings:{item:"=videoItem",currentSubreddit:"=currentSubreddit"},templateUrl:"views/video-item.html",controller:["PlayerService",function(t){this.playerService=t}]})}();